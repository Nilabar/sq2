!!!
%html
  %head
    %meta{:content => "text/html; charset=UTF-8", "http-equiv" => "Content-Type"}/
    %title chat 1111
    %meta{:charset => "UTF-8"}/
    %meta{:content => "width=device-width, initial-scale=1.0", :name => "viewport"}/
    %link{:href => "https://fonts.googleapis.com/css?family=Jura", :rel => "stylesheet"}/
    %link{:href => "https://fonts.googleapis.com/css?family=Ubuntu+Mono", :rel => "stylesheet"}/
    %link{:href => "https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css", :rel => "stylesheet"}/
    %link#bootstrap-css{:href => "//maxcdn.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css", :rel => "stylesheet"}/
    %script{:src => "https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"}
    
    /%script{:src => "https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.js"}
    /%script{:src => "https://code.jquery.com/jquery-migrate-3.0.1.js"}
    %script{:src => "http://nilabar.h1n.ru/sq2/js/jquery.imagemapster.js", :type => "text/javascript"}
    %script{:src => "https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"}
    %script{:src => "//maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"}
    %script{:src => "https://cdnjs.cloudflare.com/ajax/libs/phaser/2.6.2/phaser.min.js"}
    /%script{:src => "https://cdnjs.cloudflare.com/ajax/libs/pixi.js/4.7.1/pixi.min.js"}
    
    
    %link{:href => "styles/dev_chat_style.css", :rel => "stylesheet", :type => "text/css"}/
  %body
    .container-fluid
      #menuarea.row
        .col-md-12{:style => "padding:0"}
          .d-flex.justify-content-start
            #block-menu-container
              %img#block-menu-img{:alt => "", :src => "http://nilabar.h1n.ru/sq2/img/block_menu.png", :style => "border-style:none;z-index: 100", :usemap => "#blockmenu"}/
              %map#blockmenu{:name => "blockmenu"}
                %area{:bmkey => "atlas", :coords => "130, 3, 162, 31", :href => "#", :shape => "rect",:id => "menu-atlas"}/
                %area{:bmkey => "help", :coords => "391, 3, 431, 31", :href => "#", :shape => "rect",:id => "menu-help"}/
                %area{:bmkey => "economy", :coords => "326, 3, 382, 31", :href => "#", :shape => "rect",:id => "menu-economy"}/
                %area{:bmkey => "recepion", :coords => "270, 3, 318, 31", :href => "#", :shape => "rect",:id => "menu-recepion"}/
                %area{:bmkey => "profile", :coords => "218, 3, 258, 31", :href => "#", :shape => "rect",:id => "menu-profile"}/
                %area{:bmkey => "orbit", :coords => "171, 3, 207, 31", :href => "#", :shape => "rect",:id => "menu-orbit"}/
                %area{:bmkey => "dashboard", :coords => "101, 117, 121, 143, 83, 151, 79, 123",:id => "menu-dashboard", :href => "#", :shape => "poly"}/
                %area{:bmkey => "b8", :coords => "123, 95, 149, 109, 123, 138, 103, 113", :href => "#", :shape => "poly"}/
                %area{:bmkey => "settings", :coords => "131, 64, 157, 64, 155, 103, 147, 103, 125, 91", :href => "#", :shape => "poly"}/
                %area{:bmkey => "b10", :coords => "41, 159, 51, 118, 75, 123, 80, 156", :href => "#", :shape => "poly"}/
                %area{:bmkey => "b11", :coords => "37, 152, 46, 123, 24, 109, 3, 131", :href => "#", :shape => "poly"}/
            #block-user-container.ml-auto
              #user-canvas-cont
                %canvas#user-canvas{:height => "120", :width => "220"}
              %img#block-user-img{:alt => "", :src => "http://nilabar.h1n.ru/sq2/img/block_user.png", :style => "border-style:none;z-index: 101", :usemap => "#blockuser"}/
              %map#blockuser{:name => "blockuser"}
                %area{:bmkey => "l1", :coords => "47, 33, 46, 44, 52, 44, 53, 33", :href => "#", :shape => "poly"}/
                %area{:bmkey => "l2", :coords => "51, 33, 50, 44, 56, 44, 57, 33", :href => "#", :shape => "poly"}/
                %area{:bmkey => "l3", :coords => "55, 33, 54, 44, 60, 44, 61, 33", :href => "#", :shape => "poly"}/
                %area{:bmkey => "l4", :coords => "59, 33, 58, 44, 64, 44, 65, 33", :href => "#", :shape => "poly"}/
                %area{:bmkey => "l5", :coords => "63, 33, 62, 44, 68, 44, 69, 33", :href => "#", :shape => "poly"}/
                %area{:bmkey => "l6", :coords => "67, 33, 66, 44, 72, 44, 73, 33", :href => "#", :shape => "poly"}/
                %area{:bmkey => "l7", :coords => "71, 33, 70, 44, 76, 44, 77, 33", :href => "#", :shape => "poly"}/
                %area{:bmkey => "l8", :coords => "75, 33, 74, 44, 80, 44, 81, 33", :href => "#", :shape => "poly"}/
                %area{:bmkey => "l9", :coords => "79, 33, 78, 44, 84, 44, 85, 33", :href => "#", :shape => "poly"}/
                %area{:bmkey => "l10", :coords => "83, 33, 82, 44, 88, 44, 89, 33", :href => "#", :shape => "poly"}/
                %area{:bmkey => "l11", :coords => "87, 33, 86, 44, 92, 44, 93, 33", :href => "#", :shape => "poly"}/
                %area{:bmkey => "l12", :coords => "91, 33, 90, 44, 96, 44, 97, 33", :href => "#", :shape => "poly"}/
                %area{:bmkey => "l13", :coords => "95, 33, 94, 44, 100, 44, 101, 33", :href => "#", :shape => "poly"}/
                %area{:bmkey => "l14", :coords => "99, 33, 98, 44, 104, 44, 105, 33", :href => "#", :shape => "poly"}/
                %area{:bmkey => "l15", :coords => "103, 33, 102, 44, 108, 44, 109, 33", :href => "#", :shape => "poly"}/
                %area{:bmkey => "l16", :coords => "107, 33, 106, 44, 112, 44, 113, 33", :href => "#", :shape => "poly"}/
                %area{:bmkey => "l17", :coords => "111, 33, 110, 44, 116, 44, 117, 33", :href => "#", :shape => "poly"}/
                %area{:bmkey => "l18", :coords => "115, 33, 114, 44, 120, 44, 121, 33", :href => "#", :shape => "poly"}/
                %area{:bmkey => "l19", :coords => "119, 33, 115, 44, 124, 44, 125, 33", :href => "#", :shape => "poly"}/
                %area{:bmkey => "l20", :coords => "123, 33, 119, 44, 128, 44, 129, 33", :href => "#", :shape => "poly"}/
                %area{:bmkey => "i1", :coords => "106, 82, 132, 68, 128, 47, 97, 47", :href => "#", :shape => "poly"}/
                %area{:bmkey => "i2", :coords => "133, 109, 148, 83, 135, 69, 109, 85", :href => "#", :shape => "poly"}/
                %area{:bmkey => "i3", :coords => "170, 119, 169, 89, 151, 84, 135, 111", :href => "#", :shape => "poly"}/
      #gamearea.row
        .col-md-1{:style => "color: #7482a2;"}
          .d-flex.align-items-start.flex-column{:style => "height: 90%;"}
            #info-system.mb-auto
              %strong Система Новый дом
              %ul
                %li планет: 10
                %li класс: 
                %li владелец: Администрация
            %div
              %a#btn-mui-planet.btn.btn-mui
                 
                %img{:src => "http://nilabar.h1n.ru/sq2/img/planet_mui.png"}/
                / img src="ex_img/circle_h_mui.png"
                 
                %small Возрождение
            %div
              %a#btn-mui-system.btn.btn-mui
                 
                %img{:src => "http://nilabar.h1n.ru/sq2/img/system_mui.png"}>/
                 
                %small Новый дом
            %div
              %a#btn-mui-claster.btn.btn-mui
                 
                %img{:src => "http://nilabar.h1n.ru/sq2/img/claster_mui.png"}>/
                 
                %small а хрен его знает..
        #gamearea-point.col-md-10
          = yield
        .col-md-1
          .d-flex.align-items-start.flex-column.text-danger{:style => "height: 95%;"}
            .mb-auto
            %div
              %a#btn-mui-logout.btn-mui
                 
                %img{:src => "http://nilabar.h1n.ru/sq2/img/r_mui.png"}/
      :javascript
      
        var menu_key = 'orbit';
        
      
        $(".btn-mui").on("click",(evt)=>{
                var ui = $(evt.target).closest("a");
                switch($(ui).attr("id")){
                    case "btn-mui-logout":
                       
                    break;
                    case "btn-mui-planet":
                       
                    break;
                    case "btn-mui-system":
                       
                    break;
                    case "btn-mui-claster":
                       
                    break;
               } 
            });                    
        
        
            $( document ).ready(function() {
        
            var user_canvas=document.getElementById("user-canvas");
            var thumbImg = document.createElement('img');
        
            thumbImg.src = 'http://nilabar.h1n.ru/sq2/img/avatar_4.jpg';
            thumbImg.onload = function() {
                var ch = user_canvas.height;
                var cw = user_canvas.width;
                var iw = thumbImg.width;
                var ih = thumbImg.height;
                const mr =10;
                const si = 75;
                const r = 35;
                console.log("-canvas->",cw,ch,"-img->",iw,ih);
                var tmpCtx = user_canvas.getContext('2d');
                tmpCtx.save();
                tmpCtx.strokeStyle='rgb(37, 177, 246)';
                tmpCtx.fillStyle='rgba(242, 242, 242,.8)';
                tmpCtx.font = "1rem Ubuntu bold";
                tmpCtx.fillText("nilabar", 50, 25);   
                tmpCtx.beginPath();
                tmpCtx.arc(cw-si-mr +r, mr+r, r, 0, Math.PI * 2, true);
                tmpCtx.closePath();
                tmpCtx.clip();
        
                tmpCtx.drawImage(thumbImg, cw-si-mr, mr, si, si);
                 
                /*tmpCtx.beginPath();
                tmpCtx.arc(0, 0, 50, 0, Math.PI * 2, true);
                tmpCtx.clip();
                tmpCtx.closePath();*/
                tmpCtx.restore();
            };
            
        //$("#menu-dashboard").click();
        
        });
            
           var menu_contol = $('img#block-menu-img').mapster({
                mapKey:'bmkey',
                stroke: false,
                isSelectable:false,
                fillColor:'0099ff',
                fillOpacity: 1 ,
                showToolTip:false,
                altImage:'http://nilabar.h1n.ru/sq2/img/block_menu_alt.png',
                render_highlight: {
                    strokeWidth: 1,
                    strokeColor:'0099ff'
                },
                onClick:(data)=>{
                    console.log("menu-block onClick: ",data.key);
                    switch(data.key){
                      case "orbit":
                      
                      break;
                    }
                    
                $("#gamearea").load("/game/ajax/panel?cmd="+data.key,(response,status,xhr)=>{    
                    if(status == "success"){
                        menu_contol.mapster('set',false,menu_key);
                        menu_contol.mapster('set',true,data.key);
                        menu_key = data.key;
                        console.log(status);
                    }
                 });     
                    
                    
                    
                }
            });
            
            $('img#block-user-img').mapster({
                mapKey:'bmkey',
                stroke: false,
                isSelectable:false,
                fillColor:'0099ff',
                fillOpacity: 1 ,
                showToolTip:false,
                altImage:'http://nilabar.h1n.ru/sq2/img/block_user_alt.png',
                render_highlight: {
                    strokeWidth: 1,
                    strokeColor:'0099ff'
                },
                onClick:(data)=>{
                    console.log("usr-block onClick: ",data);
                    
                }
            }).mapster('set',true,'l1,l2,l3,l4,l5,l6,l7,l8,l9,l10,l11,l12,l13,l14,l15');
            
            
            
      #chl-tabs-area.row.text-muted.hc-block.d-none
        / div class="d-inline bg-dark text-muted tabs-first-el chl-tabs-ui"><a class="btn btn-chl-ui"><i class="fa fa-chevron-left"></i></a></div
        / div class="d-inline bg-dark text-muted chl-tabs-ui"><a class="btn btn-chl-ui"><i class="fa fa-chevron-right"></i></a></div
        #chl-tabs-close.d-inline.bg-dark.text-muted.tabs-last-el.chl-tabs-ui
          %a.btn.btn-chl-ui
            %i.fa.fa-times
      #chatarea.row
        .donut-spinner
        #chat-block.col-md-7.d-none
          .card
            .card-header
              .btn-group.btn-group-sm
                %button#ui-b-globe.btn.btn-dark.chat.chat-ui{:type => "button"}
                  %i.fa.fa-globe
                %button#ui-b-events.btn.btn-dark.chat.chat-ui{:type => "button"}
                  %i.fa.fa-exclamation-circle>
                   
                  %span.badge.badge-dark 5
                %button#ui-b-tabs.btn.btn-dark.chat.chat-ui{:type => "button"}
                  %i.fa.fa-ellipsis-h
                %button#ui-b-info.btn.btn-dark.chat.chat-ui.d-none{:type => "button"}
                  %i.fa.fa-info-circle
                %button#ui-b-user.btn.btn-dark.chat.chat-ui.d-none{:type => "button"}
                  %i.fa.fa-user
            #chat-point.card-body
              / div class="scrollbar text-info"></div
            .card-footer
              #message-out-group.input-group
                %input#message-input-area.form-control{:placeholder => "", :type => "text"}/
                .input-group-btn
                  #emojy-btn.btn
                  %button#message-send-btn.btn.btn-dark.chat{:type => "button"}
                     
                    %img{:src => "http://nilabar.h1n.ru/sq2/img/SEND.png"}/
        #online-block.col-md-2.text-info.hc-block.d-none
          .card
            .card-header.btn-group.btn-group-sm.d-inline-flex.justify-content-end
              .btn.disabled.text-secondary.mr-auto
                %i.fa.fa-user>
                 
                %span#online-user.badge.badge-dark 00
              %button.btn.btn-dark.chat.block-close-btn
                %i.fa.fa-times
            .card-body
              #online-pointer.scrollbar.text-muted
            .card-footer.text-center
              #online-progress-container
                %span#logo-server s
                %span#logo-server.flip-horizontal s
                #server-workload.progress.chat
                  #server-workload-bar.progress-bar{"aria-valuemax" => "100", "aria-valuemin" => "0", "aria-valuenow" => "70", :role => "progressbar", :style => "width:70%"}
        #info-block.col-md-3.text-info.hc-block.d-none
          .card
            .card-header.btn-group.btn-group-sm.d-inline-flex.justify-content-end
              .btn.disabled.text-secondary.mr-auto
                %i.fa.fa-info-circle>
                 
              %button#ui-b-ban.btn.btn-dark.chat.chat-ui.chat-ui-info{:type => "button"}
                %i.fa.fa-ban
              %button#ui-b-list.btn.btn-dark.chat.chat-ui.chat-ui-info{:type => "button"}
                %i.fa.fa-list-alt
              %button#ui-b-settings.btn.btn-dark.chat.chat-ui.chat-ui-info{:type => "button"}
                %i.fa.fa-cog
              %button.btn.btn-dark.chat.block-close-btn
                %i.fa.fa-times
            #info-point.card-body
              #setting-list.info-item.d-none
                %label.switch
                  %input{:type => "checkbox"}/
                  %span.slider.round
    %script{:src => "js/dev_chat.js"}
